title = "Detalhes da Consulta"
layout = "default"
is_hidden = 1
==
<?php
function onStart()
{
    $id = $this->param('id');
    $token = $this->param('token');
    
    $appointment = \Doctor\Appointments\Models\Appointment::find($id);
    
    if (!$appointment) {
        $this->page->title = 'Consulta Não Encontrada';
        $this['appointment'] = null;
        $this['error'] = 'not_found';
        return;
    }
    
    if (!$appointment->verifyPublicToken($token)) {
        $this->page->title = 'Acesso Negado';
        $this['appointment'] = null;
        $this['error'] = 'invalid';
        return;
    }
    
    $appointment->load('consultation_type');
    $this['appointment'] = $appointment;
    $this['token'] = $token;
    $this['csrf_token'] = \Illuminate\Support\Facades\Session::token();
    $this['error'] = null;
}
?>
==
<div class="appointment-view-container" style="margin-top: 80px;">
    <div class="appointment-header">
        <h1>Detalhes da Consulta</h1>
    </div>

    <div class="appointment-content">
        {% if error == 'not_found' %}
            <div class="error-message">
                <p>Consulta não encontrada.</p>
            </div>
        {% elseif error == 'invalid' %}
            <div class="error-message">
                <p>O link de acesso é inválido ou expirado.</p>
                <p>Por favor, verifique o link recebido por email ou entre em contato conosco.</p>
            </div>
        {% elseif appointment %}
            <div class="appointment-card">
                <div class="status-badge status-{{ appointment.status }}">
                    <span>{{ appointment.status_text }}</span>
                </div>

                <div class="appointment-details">
                    <div class="detail-section">
                        <h3>Informações do Paciente</h3>
                        <div class="detail-item">
                            <span class="detail-label">Nome:</span>
                            <span class="detail-value">{{ appointment.patient_name }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Email:</span>
                            <span class="detail-value">{{ appointment.email }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Telefone:</span>
                            <span class="detail-value">{{ appointment.phone }}</span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>Detalhes da Consulta</h3>
                        <div class="detail-item">
                            <span class="detail-label">Data e Hora:</span>
                            <span class="detail-value">{{ appointment.appointment_time|date('d/m/Y H:i') }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Tipo de Consulta:</span>
                            <span class="detail-value">{{ appointment.consultation_type.name }}</span>
                        </div>
                        {% if appointment.description %}
                        <div class="detail-item">
                            <span class="detail-label">Descrição:</span>
                            <span class="detail-value">{{ appointment.description }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if appointment.canBeCancelled() %}
                <div class="cancel-section">
                    <p class="cancel-notice">Se você deseja cancelar esta consulta, clique no botão abaixo.</p>
                    <form method="POST" action="{{ url('appointment/' ~ appointment.id ~ '/' ~ token ~ '/cancel') }}">
                        <input type="hidden" name="_token" value="{{ csrf_token }}">
                        <button type="submit" class="btn-cancel" onclick="return confirm('Tem certeza que deseja cancelar esta consulta?');">
                            Cancelar Consulta
                        </button>
                    </form>
                </div>
                {% elseif appointment.isCancelledByPatient() %}
                <div class="cancelled-notice">
                    <p>Esta consulta foi cancelada por você.</p>
                </div>
                {% elseif appointment.isCancelled() %}
                <div class="cancelled-notice">
                    <p>Esta consulta foi cancelada.</p>
                </div>
                {% else %}
                <div class="past-notice">
                    <p>Esta consulta já foi realizada e não pode ser cancelada.</p>
                </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<style>
.appointment-view-container {
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
}

.appointment-header {
    text-align: center;
    margin-bottom: 40px;
}

.appointment-header h1 {
    font-size: 2rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0;
}

.appointment-card {
    background: white;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.status-badge {
    display: inline-block;
    padding: 8px 20px;
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 25px;
    text-align: center;
}

.status-badge.status-pending {
    background: linear-gradient(135deg, #ff9500, #ff6b00);
}

.status-badge.status-approved {
    background: linear-gradient(135deg, #28a745, #20c997);
}

.status-badge.status-cancelled,
.status-badge.status-cancelled_by_patient {
    background: linear-gradient(135deg, #dc3545, #c82333);
}

.status-badge span {
    color: white;
}

.appointment-details {
    margin-bottom: 30px;
}

.detail-section {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid #e9ecef;
}

.detail-section:last-child {
    border-bottom: none;
}

.detail-section h3 {
    font-size: 1.2rem;
    font-weight: 500;
    color: #2c3e50;
    margin-bottom: 15px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    padding: 8px 0;
}

.detail-label {
    font-weight: 500;
    color: #495057;
    min-width: 150px;
}

.detail-value {
    color: #2c3e50;
    text-align: right;
    flex: 1;
}

.cancel-section {
    margin-top: 30px;
    padding-top: 25px;
    border-top: 2px solid #e9ecef;
    text-align: center;
}

.cancel-notice {
    font-size: 0.95rem;
    color: #6c757d;
    margin-bottom: 20px;
}

.btn-cancel {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
    border: none;
    padding: 12px 30px;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 3rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
}

.btn-cancel:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
}

.btn-cancel:active {
    transform: translateY(0);
}

.cancelled-notice,
.past-notice {
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 4px;
    text-align: center;
}

.cancelled-notice p,
.past-notice p {
    margin: 0;
    color: #6c757d;
    font-weight: 500;
}

.error-message {
    text-align: center;
    padding: 40px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.error-message p {
    font-size: 1.1rem;
    color: #dc3545;
    margin-bottom: 10px;
}

@media (max-width: 768px) {
    .appointment-view-container {
        margin: 20px auto;
        padding: 15px;
    }

    .appointment-card {
        padding: 20px;
    }

    .detail-item {
        flex-direction: column;
        align-items: flex-start;
    }

    .detail-label {
        min-width: auto;
        margin-bottom: 5px;
    }

    .detail-value {
        text-align: left;
    }
}
</style>

